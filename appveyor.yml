image: Visual Studio 2022

environment:
  matrix:
    - PYTHON: "C:\\Python310-x64"
      PYTHON_VERSION: "3.10"
    - PYTHON: "C:\\Python311-x64"
      PYTHON_VERSION: "3.11"
    - PYTHON: "C:\\Python312-x64"
      PYTHON_VERSION: "3.12"
    - PYTHON: "C:\\Python313-x64"
      PYTHON_VERSION: "3.13"
    - PYTHON: "C:\\Python314-x64"
      PYTHON_VERSION: "3.14.0"

matrix:
  fast_finish: true

init:
  - "ECHO Python %PYTHON_VERSION% at %PYTHON%"

install:
  - "SET PATH=%PYTHON%;%PYTHON%\\Scripts;%PATH%"
  - "python --version"
  - "python -c \"import struct; print('pointer size:', struct.calcsize('P') * 8, 'bit')\""

  - "python -m pip install --upgrade pip setuptools wheel build"
  - "pip install python-dateutil numpy matplotlib pytest"

  - choco install swig -y

  # Install jupyter and mypy only for Python 3.10
  - ps: |
      if ($env:PYTHON_VERSION -eq "3.10") {
        pip install jupyter mypy types-python-dateutil mock
      }

build_script:
  - "python -m pip install ."

test_script:
  - "pytest"
  - "python -c \"import oapackage; print(oapackage)\""

  # Run mypy and notebooks only for Python 3.10
  - ps: |
      if ($env:PYTHON_VERSION -eq "3.10") {
        mypy --version
        mypy -p oapackage --follow-imports skip

        $notebooks = Get-ChildItem -Path "docs/examples/*.ipynb"
        foreach ($nb in $notebooks) {
          Write-Host "Executing notebook: $($nb.Name)"
          jupyter nbconvert --to notebook --execute $nb.FullName
        }
      }

after_test:
  - "python -m pip wheel . -w dist"
  - ps: |
      if ($env:PYTHON_VERSION -eq "3.10") {
        python -Im build --sdist
      }
  - ps: "Get-ChildItem dist"

artifacts:
  - path: dist\*
    name: binaries
